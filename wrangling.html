<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data wrangling using dplyr and tidyr</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="_includes/style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Code As Manuscript</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Workshops
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="instructions.html">
        <span class="fa fa-exclamation"></span>
         
        Pre-workshop instructions
      </a>
    </li>
    <li>
      <a href="syllabus.html">
        <span class="fa fa-map-o"></span>
         
        Syllabus
      </a>
    </li>
    <li>
      <a href="intro.html">
        <span class="fa fa-file-code-o"></span>
         
        Introduction to R and RStudio
      </a>
    </li>
    <li>
      <a href="wrangling.html">
        <span class="fa fa-database"></span>
         
        Data managing/wrangling
      </a>
    </li>
    <li>
      <a href="plots.html">
        <span class="fa fa-line-chart"></span>
         
        Data visualization
      </a>
    </li>
    <li>
      <a href="reports.html">
        <span class="fa fa-file-text"></span>
         
        Statistics and report generation
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-question"></span>
     
    Resources/FAQ
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bars"></span>
     
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="mailto:codeasmanuscript@gmail.com">
        <span class="fa fa-envelope"></span>
         
        Contact
      </a>
    </li>
    <li>
      <a href="https://github.com/codeasmanuscript">
        <span class="fa fa-github"></span>
         
        GitHub
      </a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data wrangling using dplyr and tidyr</h1>

</div>


<blockquote>
<p>Data wrangling: loosely, the process of manually converting data from one “raw” form into another format that allows for more ease of eventual analysis and visualization (adapted from <a href="https://en.wikipedia.org/wiki/Data_wrangling">Wikipedia</a>)</p>
</blockquote>
<p>R was developed by statisticians to do statistical work. As such, embedded within R are capabilities to easily wrangle and manage data, to have data in a format that can be used for further analysis, and to work with datasets called dataframes. There are also excellent packages available to make data wrangling much easier in R. These packages are <code>dplyr</code> and <code>tidyr</code>. A minor assumption about using these packages: the data you are importing from the start is fairly clean (i.e. no large amount of missing values, no data entry errors or fixes needed, etc).</p>
<div id="learning-objectives" class="section level1">
<h1>Learning objectives:</h1>
<ul>
<li>Appreciate that data wrangling and managing are important and time-consuming aspects to research</li>
<li>Learn the ‘grammar’ of shaping and moving data from one form to another</li>
<li>Understand and apply basic statistics to quickly summarize your dataset</li>
</ul>
</div>
<div id="lets-get-wrangling-the-basics" class="section level1">
<h1>Let’s get wrangling, the basics</h1>
<div id="wrangling-your-data-dplyr-style" class="section level2">
<h2>Wrangling your data, <code>dplyr</code> style</h2>
<p>Data wrangling can be a bit tedious in base R (R without packages), so we’ll be using two packages designed to make this easier. <code>dplyr</code> comes with a <code>%&gt;%</code> pipe function (via the <code>magrittr</code> package), which works similar to how the Bash shell <code>|</code> pipe works (for those familiar with Bash, ie. those who use Mac or Linux). The command on the right-hand side takes the output from the command on the left-hand side, just like how a plumbing pipe works for water. <code>tbl_df</code> makes the object into a <code>tbl</code> class, making printing of the output nicer. The other nice thing about <code>dplyr</code> is that it can connect to SQL and other type of databases and is very fast at wrangling data, unlike base R. Check out the <a href="../resources/">resources page</a> for links to more about this.</p>
<pre class="r"><code>library(dplyr)
library(tidyr)
library(readr)

# Import the dataset
ds &lt;- read_csv(&quot;http://codeasmanuscript.org/states_data.csv&quot;)

## Compare
head(ds)</code></pre>
<pre><code>## # A tibble: 6 x 13
##    StateName Population Income Illiteracy LifeExp Murder HSGrad Frost
##        &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1    Alabama       3615   3624        2.1   69.05   15.1   41.3    20
## 2     Alaska        365   6315        1.5   69.31   11.3   66.7   152
## 3    Arizona       2212   4530        1.8   70.55    7.8   58.1    15
## 4   Arkansas       2110   3378        1.9   70.66   10.1   39.9    65
## 5 California      21198   5114        1.1   71.71   10.3   62.6    20
## 6   Colorado       2541   4884        0.7   72.06    6.8   63.9   166
## # ... with 5 more variables: Area &lt;dbl&gt;, Region &lt;chr&gt;, Division &lt;chr&gt;,
## #   Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;</code></pre>
<pre class="r"><code>## With:
tbl_df(ds)</code></pre>
<pre><code>## # A tibble: 50 x 13
##      StateName Population Income Illiteracy LifeExp Murder HSGrad Frost
##          &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1     Alabama       3615   3624        2.1   69.05   15.1   41.3    20
##  2      Alaska        365   6315        1.5   69.31   11.3   66.7   152
##  3     Arizona       2212   4530        1.8   70.55    7.8   58.1    15
##  4    Arkansas       2110   3378        1.9   70.66   10.1   39.9    65
##  5  California      21198   5114        1.1   71.71   10.3   62.6    20
##  6    Colorado       2541   4884        0.7   72.06    6.8   63.9   166
##  7 Connecticut       3100   5348        1.1   72.48    3.1   56.0   139
##  8    Delaware        579   4809        0.9   70.06    6.2   54.6   103
##  9     Florida       8277   4815        1.3   70.66   10.7   52.6    11
## 10     Georgia       4931   4091        2.0   68.54   13.9   40.6    60
## # ... with 40 more rows, and 5 more variables: Area &lt;dbl&gt;, Region &lt;chr&gt;,
## #   Division &lt;chr&gt;, Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;</code></pre>
<pre class="r"><code>## Now put the tbl dataset into a new object
ds2 &lt;- tbl_df(ds)
ds2</code></pre>
<pre><code>## # A tibble: 50 x 13
##      StateName Population Income Illiteracy LifeExp Murder HSGrad Frost
##          &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1     Alabama       3615   3624        2.1   69.05   15.1   41.3    20
##  2      Alaska        365   6315        1.5   69.31   11.3   66.7   152
##  3     Arizona       2212   4530        1.8   70.55    7.8   58.1    15
##  4    Arkansas       2110   3378        1.9   70.66   10.1   39.9    65
##  5  California      21198   5114        1.1   71.71   10.3   62.6    20
##  6    Colorado       2541   4884        0.7   72.06    6.8   63.9   166
##  7 Connecticut       3100   5348        1.1   72.48    3.1   56.0   139
##  8    Delaware        579   4809        0.9   70.06    6.2   54.6   103
##  9     Florida       8277   4815        1.3   70.66   10.7   52.6    11
## 10     Georgia       4931   4091        2.0   68.54   13.9   40.6    60
## # ... with 40 more rows, and 5 more variables: Area &lt;dbl&gt;, Region &lt;chr&gt;,
## #   Division &lt;chr&gt;, Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;</code></pre>
</div>
<div id="select-columns" class="section level2">
<h2>Select columns</h2>
<p>Often times, you want to select only some of the columns or variables from a dataset. For that we use the <code>select</code> command, which does as it says. Note the use of the <code>%&gt;%</code> operator. This allows you to chain commands together, letting you do more with only a few commands.</p>
<pre class="r"><code>ds2 %&gt;% 
    select(Population, Income, Area)</code></pre>
<pre><code>## # A tibble: 50 x 3
##    Population Income   Area
##         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1       3615   3624  50708
##  2        365   6315 566432
##  3       2212   4530 113417
##  4       2110   3378  51945
##  5      21198   5114 156361
##  6       2541   4884 103766
##  7       3100   5348   4862
##  8        579   4809   1982
##  9       8277   4815  54090
## 10       4931   4091  58073
## # ... with 40 more rows</code></pre>
<p>The real power with using the <code>select()</code> function comes when you combine it with <a href="http://www.regular-expressions.info/">regular expressions (regexp)</a>, or rather pattern searching. <code>dplyr</code> has several pattern searching functions, including <code>starts_with()</code>, <code>contains()</code>, and the most powerful <code>matches()</code>. The function <code>matches()</code> uses regexp, which are special commands that use certain, unique syntax for searching for patterns. For example, <code>^string</code> means that <code>string</code> is the first character, <code>string$</code> means that <code>string</code> is last character, <code>string|strung</code> searches for either <code>string</code> or <code>strung</code>, etc. regexp syntax are nearly a language to themselves, so use <a href="http://stackoverflow.com/">StackOverflow</a> and Google as much as you can!</p>
<p>Ok, so lets say you want to search for variables that have certain patterns:</p>
<pre class="r"><code>ds2 %&gt;% 
    select(contains(&#39;Pop&#39;), starts_with(&#39;Fr&#39;))</code></pre>
<pre><code>## # A tibble: 50 x 2
##    Population Frost
##         &lt;dbl&gt; &lt;dbl&gt;
##  1       3615    20
##  2        365   152
##  3       2212    15
##  4       2110    65
##  5      21198    20
##  6       2541   166
##  7       3100   139
##  8        579   103
##  9       8277    11
## 10       4931    60
## # ... with 40 more rows</code></pre>
<pre class="r"><code>## Or more simplified
ds2 %&gt;% 
    select(matches(&#39;Pop|Fr&#39;))</code></pre>
<pre><code>## # A tibble: 50 x 2
##    Population Frost
##         &lt;dbl&gt; &lt;dbl&gt;
##  1       3615    20
##  2        365   152
##  3       2212    15
##  4       2110    65
##  5      21198    20
##  6       2541   166
##  7       3100   139
##  8        579   103
##  9       8277    11
## 10       4931    60
## # ... with 40 more rows</code></pre>
<p>You can see that if you have many variables that have a common structure to their name, you can quickly select all those variables by using functions such as <code>matches()</code>.</p>
</div>
<div id="rename-columns" class="section level2">
<h2>Rename columns</h2>
<p>You can rename columns using the <code>rename</code> command (the new name is on the left hand side, so <code>newname = oldname</code>).</p>
<pre class="r"><code>ds2 %&gt;% 
    rename(HighSchoolGrad = HSGrad)</code></pre>
<pre><code>## # A tibble: 50 x 13
##      StateName Population Income Illiteracy LifeExp Murder HighSchoolGrad
##          &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;
##  1     Alabama       3615   3624        2.1   69.05   15.1           41.3
##  2      Alaska        365   6315        1.5   69.31   11.3           66.7
##  3     Arizona       2212   4530        1.8   70.55    7.8           58.1
##  4    Arkansas       2110   3378        1.9   70.66   10.1           39.9
##  5  California      21198   5114        1.1   71.71   10.3           62.6
##  6    Colorado       2541   4884        0.7   72.06    6.8           63.9
##  7 Connecticut       3100   5348        1.1   72.48    3.1           56.0
##  8    Delaware        579   4809        0.9   70.06    6.2           54.6
##  9     Florida       8277   4815        1.3   70.66   10.7           52.6
## 10     Georgia       4931   4091        2.0   68.54   13.9           40.6
## # ... with 40 more rows, and 6 more variables: Frost &lt;dbl&gt;, Area &lt;dbl&gt;,
## #   Region &lt;chr&gt;, Division &lt;chr&gt;, Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;</code></pre>
</div>
<div id="filter-rows" class="section level2">
<h2>Filter rows</h2>
<p>Another common task in data wrangling is subsetting your dataset. You can subset the dataset using <code>filter</code>. Note the double equal sign <code>==</code> for testing if ‘Examination’ is equal to 15. A single <code>=</code> is used for something else (assigning things to objects or using them in functions/commands).</p>
<pre class="r"><code>## For continuous/number data
ds2 %&gt;% 
    select(Population, Illiteracy, Income, Region) %&gt;% 
    filter(Illiteracy &lt; 2, Population == 365)</code></pre>
<pre><code>## # A tibble: 1 x 4
##   Population Illiteracy Income Region
##        &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;chr&gt;
## 1        365        1.5   6315   West</code></pre>
<pre class="r"><code>## Or for &#39;string&#39; (words or letters) data
ds2 %&gt;%
    select(Population, Illiteracy, Income, Region) %&gt;% 
    filter(Region == &#39;Northeast&#39;)</code></pre>
<pre><code>## # A tibble: 9 x 4
##   Population Illiteracy Income    Region
##        &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;     &lt;chr&gt;
## 1       3100        1.1   5348 Northeast
## 2       1058        0.7   3694 Northeast
## 3       5814        1.1   4755 Northeast
## 4        812        0.7   4281 Northeast
## 5       7333        1.1   5237 Northeast
## 6      18076        1.4   4903 Northeast
## 7      11860        1.0   4449 Northeast
## 8        931        1.3   4558 Northeast
## 9        472        0.6   3907 Northeast</code></pre>
</div>
<div id="create-new-columns-or-clean-up-existing-ones" class="section level2">
<h2>Create new columns or clean up existing ones</h2>
<p>If you want to create a new column, you use the <code>mutate</code> command. The <code>ifelse()</code> command lets you use a condition to have different values depending on the condition.</p>
<pre class="r"><code>ds2 %&gt;%
    mutate(Testing = &#39;yes&#39;,
           Rich = ifelse(Income &gt; 5000, &#39;Yes&#39;, &#39;No&#39;)) %&gt;% 
    select(StateName, Population, Income, Rich, Testing)</code></pre>
<pre><code>## # A tibble: 50 x 5
##      StateName Population Income  Rich Testing
##          &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;
##  1     Alabama       3615   3624    No     yes
##  2      Alaska        365   6315   Yes     yes
##  3     Arizona       2212   4530    No     yes
##  4    Arkansas       2110   3378    No     yes
##  5  California      21198   5114   Yes     yes
##  6    Colorado       2541   4884    No     yes
##  7 Connecticut       3100   5348   Yes     yes
##  8    Delaware        579   4809    No     yes
##  9     Florida       8277   4815    No     yes
## 10     Georgia       4931   4091    No     yes
## # ... with 40 more rows</code></pre>
<p>However, it’s fairly common that you need to do some data janitorial work by cleaning up an existing column. For example, in a dataset with a ‘Sex’ variable, some values had data entry errors in spelling, such as ‘fmale’ when it should be ‘female’. This needs to be fixed and can be done fairly easily in R. So let’s ‘pretend that all words starting with ’G’ in the <code>X</code> (county) column should ‘actually be ’J’ and that all words with an ‘e’ at the end should be removed. ‘For this, we will use the <code>gsub()</code> command within <code>mutate()</code>, which will’<em>g</em>lobablly <em>sub</em>stitute a pattern with the replacement.</p>
<pre class="r"><code>ds2 %&gt;% 
    select(Region) %&gt;% 
    mutate(
        Region = gsub(pattern = &#39;^S&#39;, replacement = &#39;J&#39;, Region),
        Region = gsub(pattern = &#39;t$&#39;, replacement = &#39;&#39;, Region)
        )</code></pre>
<pre><code>## # A tibble: 50 x 1
##      Region
##       &lt;chr&gt;
##  1    Jouth
##  2      Wes
##  3      Wes
##  4    Jouth
##  5      Wes
##  6      Wes
##  7 Northeas
##  8    Jouth
##  9    Jouth
## 10    Jouth
## # ... with 40 more rows</code></pre>
<p>Notice the <code>^</code> and <code>$</code> characters. Those are special syntax symbols used in regexp commands. We introduced them above, but we’ll quickly go over it again. These special symbols perform certain functions. In this case <code>^G</code> means for all “G” that are at the start of the string/character, while <code>e$</code> means for all “e” that are at the end of a string. Or let“s say that all”mont“,”mout“, and”mnt&quot; should actually be “ment”. We can do some cleaning fairly easily here.</p>
<pre class="r"><code>ds2 %&gt;% 
    mutate(Region = gsub(&#39;Northeast&#39;, &#39;NE&#39;, Region, ignore.case = TRUE)) %&gt;% 
    select(Region)</code></pre>
<pre><code>## # A tibble: 50 x 1
##    Region
##     &lt;chr&gt;
##  1  South
##  2   West
##  3   West
##  4  South
##  5   West
##  6   West
##  7     NE
##  8  South
##  9  South
## 10  South
## # ... with 40 more rows</code></pre>
<p>Regular expressions are incredibly powerful, but also can be confusing. Make sure to check out <a href="/lessons/resources/">our resources page</a> for links to sites that explain regexp in more detail.</p>
</div>
<div id="chaining-pipes" class="section level2">
<h2>Chaining pipes</h2>
<p>We can start chaining these commands together using the <code>%&gt;%</code> pipe command. There is no limit to how long a chain can be. Chaining commands together using the pipe command makes your code easier to read, makes you type out your code faster, and makes it easier for you to go from thinking of an analysis to actually conducting it. <code>arrange</code> sorts/orders/re-arranges the column Education in ascending order.</p>
<pre class="r"><code>ds2 %&gt;%
  filter(Illiteracy &gt; 2) %&gt;%
  select(State = StateName, ## This renames the variable, just like the rename() command
         Population, Area, Frost) %&gt;%
  arrange(Population) %&gt;%
  mutate(Cold = ifelse(Frost &gt; 100, &#39;Yes&#39;, &#39;No&#39;))</code></pre>
<pre><code>## # A tibble: 6 x 5
##            State Population   Area Frost  Cold
##            &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     New Mexico       1144 121412   120   Yes
## 2    Mississippi       2341  47296    50    No
## 3 South Carolina       2816  30225    65    No
## 4        Alabama       3615  50708    20    No
## 5      Louisiana       3806  44930    12    No
## 6          Texas      12237 262134    35    No</code></pre>
</div>
<div id="re-organize-your-data-using-tidyr" class="section level2">
<h2>Re-organize your data (using <code>tidyr</code>)</h2>
<p>To get the data into a nicer and more analyable format, you can use the <code>tidyr</code> package. See what <code>gather</code> does in the code below. Then see what <code>spread</code> does. Note that you can remove a column by having a minus <code>-</code> sign in front of a variable when you use <code>select</code>.</p>
<pre class="r"><code>## Compare this:
ds2 %&gt;%
  select(-Division, -Region, -matches(&#39;itude$&#39;))</code></pre>
<pre><code>## # A tibble: 50 x 9
##      StateName Population Income Illiteracy LifeExp Murder HSGrad Frost
##          &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1     Alabama       3615   3624        2.1   69.05   15.1   41.3    20
##  2      Alaska        365   6315        1.5   69.31   11.3   66.7   152
##  3     Arizona       2212   4530        1.8   70.55    7.8   58.1    15
##  4    Arkansas       2110   3378        1.9   70.66   10.1   39.9    65
##  5  California      21198   5114        1.1   71.71   10.3   62.6    20
##  6    Colorado       2541   4884        0.7   72.06    6.8   63.9   166
##  7 Connecticut       3100   5348        1.1   72.48    3.1   56.0   139
##  8    Delaware        579   4809        0.9   70.06    6.2   54.6   103
##  9     Florida       8277   4815        1.3   70.66   10.7   52.6    11
## 10     Georgia       4931   4091        2.0   68.54   13.9   40.6    60
## # ... with 40 more rows, and 1 more variables: Area &lt;dbl&gt;</code></pre>
<pre class="r"><code>## With this:
ds2 %&gt;%
  select(-Division, -Region, -matches(&#39;itude$&#39;)) %&gt;% 
  gather(Measure, Value, -StateName)</code></pre>
<pre><code>## # A tibble: 400 x 3
##      StateName    Measure Value
##          &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;
##  1     Alabama Population  3615
##  2      Alaska Population   365
##  3     Arizona Population  2212
##  4    Arkansas Population  2110
##  5  California Population 21198
##  6    Colorado Population  2541
##  7 Connecticut Population  3100
##  8    Delaware Population   579
##  9     Florida Population  8277
## 10     Georgia Population  4931
## # ... with 390 more rows</code></pre>
<pre class="r"><code>## And back again:
ds2 %&gt;%
  select(-Division, -Region, -matches(&#39;itude$&#39;)) %&gt;% 
  gather(Measure, Value, -StateName) %&gt;%
  spread(Measure, Value)</code></pre>
<pre><code>## # A tibble: 50 x 9
##      StateName   Area Frost HSGrad Illiteracy Income LifeExp Murder
##  *       &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1     Alabama  50708    20   41.3        2.1   3624   69.05   15.1
##  2      Alaska 566432   152   66.7        1.5   6315   69.31   11.3
##  3     Arizona 113417    15   58.1        1.8   4530   70.55    7.8
##  4    Arkansas  51945    65   39.9        1.9   3378   70.66   10.1
##  5  California 156361    20   62.6        1.1   5114   71.71   10.3
##  6    Colorado 103766   166   63.9        0.7   4884   72.06    6.8
##  7 Connecticut   4862   139   56.0        1.1   5348   72.48    3.1
##  8    Delaware   1982   103   54.6        0.9   4809   70.06    6.2
##  9     Florida  54090    11   52.6        1.3   4815   70.66   10.7
## 10     Georgia  58073    60   40.6        2.0   4091   68.54   13.9
## # ... with 40 more rows, and 1 more variables: Population &lt;dbl&gt;</code></pre>
</div>
<div id="summarise-variables" class="section level2">
<h2>Summarise variables</h2>
<p>Combined with <code>dplyr</code>’s <code>group_by</code> and <code>summarise</code> you can quickly summarise data or do further, more complicated analyses. <code>group_by</code> makes it so further analyses or operations work on the groups. <code>summarise</code> transforms the data to only contain the new variable(s) created, in this case the mean, as well as the grouping variable.</p>
<pre class="r"><code>ds2 %&gt;%
  select(-Division, -Region, -StateName) %&gt;% 
  gather(Measure, Value) %&gt;%
  group_by(Measure) %&gt;%
  summarise(Mean = mean(Value),
            SD = sd(Value),
            Median = median(Value),
            SampleSize = n())</code></pre>
<pre><code>## # A tibble: 10 x 5
##       Measure        Mean           SD      Median SampleSize
##         &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;      &lt;int&gt;
##  1       Area 70735.88000 8.532730e+04 54277.00000         50
##  2      Frost   104.46000 5.198085e+01   114.50000         50
##  3     HSGrad    53.10800 8.076998e+00    53.25000         50
##  4 Illiteracy     1.17000 6.095331e-01     0.95000         50
##  5     Income  4435.80000 6.144699e+02  4519.00000         50
##  6   Latitude    39.41074 4.976349e+00    39.62075         50
##  7    LifeExp    70.87860 1.342394e+00    70.67500         50
##  8  Longitude   -92.46414 1.618079e+01   -89.90030         50
##  9     Murder     7.37800 3.691540e+00     6.85000         50
## 10 Population  4246.42000 4.464491e+03  2838.50000         50</code></pre>
</div>
<div id="other-useful-and-powerful-examples" class="section level2">
<h2>Other useful and powerful examples</h2>
<p>You can do some really powerful things with <code>dplyr</code> and <code>tidyr</code> functions. For example, you can run each combination of independent and dependent variables in a linear regression (<code>lm()</code>) using <code>gather()</code> and the <code>dplyr</code> <code>do()</code> command, rather than running each individually. To make the output from the <code>lm()</code> easier to combine and understand, we use the <code>tidy()</code> command from the <code>broom</code> package (<code>::</code> tells R we want to use the <code>tidy()</code> function from the <code>broom</code> package). If you want more details on how to use this set up, <a href="http://www.lukewjohnston.com/blog/loops-forests-multiple-linear-regressions/">check out my blog post about it</a>.</p>
<pre class="r"><code>library(broom)
# Using the swiss practice dataset.
swiss %&gt;%
    gather(Indep, Xvalue, Fertility, Agriculture) %&gt;%
    gather(Dep, Yvalue, Education, Catholic) %&gt;% 
    group_by(Dep, Indep) %&gt;% 
    do(tidy(lm(Yvalue ~ Xvalue + Infant.Mortality + Examination, data = .)))</code></pre>
<pre><code>## # A tibble: 16 x 7
## # Groups:   Dep, Indep [4]
##          Dep       Indep             term    estimate   std.error
##        &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1  Catholic Agriculture      (Intercept) 48.62020731 51.22779001
##  2  Catholic Agriculture           Xvalue  0.08447534  0.31852283
##  3  Catholic Agriculture Infant.Mortality  1.69138478  1.81767192
##  4  Catholic Agriculture      Examination -2.75852964  0.91102265
##  5  Catholic   Fertility      (Intercept) 35.13701855 51.27597790
##  6  Catholic   Fertility           Xvalue  0.39943317  0.60419739
##  7  Catholic   Fertility Infant.Mortality  1.00336670  1.99122191
##  8  Catholic   Fertility      Examination -2.54831847  0.86570652
##  9 Education Agriculture      (Intercept) 12.75076261  9.86830392
## 10 Education Agriculture           Xvalue -0.13540736  0.06135889
## 11 Education Agriculture Infant.Mortality -0.21468852  0.35014860
## 12 Education Agriculture      Examination  0.56818921  0.17549554
## 13 Education   Fertility      (Intercept) 17.62086823  9.48591843
## 14 Education   Fertility           Xvalue -0.34172055  0.11177490
## 15 Education   Fertility Infant.Mortality  0.44332139  0.36837072
## 16 Education   Fertility      Examination  0.51463767  0.16015339
## # ... with 2 more variables: statistic &lt;dbl&gt;, p.value &lt;dbl&gt;</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
